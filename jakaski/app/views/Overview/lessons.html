#{extends 'content.html' /}

<h1 class="page-title">
  <i class="icon-calendar"></i> Prehľad hodín
</h1>
<div class="widget widget-table">

  <div class="widget-header">
    <i class="icon-th-list"></i>
    <h3>Table</h3>
  </div>
  <!-- /widget-header -->

  <div class="widget-content">

    <table id="lessonOverview" class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Začiatok</th>
          <th>Koniec</th>
          <th>Inštruktori</th>
          <th>Žiaci</th>
          <th>Stredisko</th>
          <th>Poznámka</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>

    <script>
        $(document).ready(function() {
            $('#lessonOverview').dataTable({
                "sAjaxSource": "@{rest.QueryController.getLessons(new Date())}",
                "sAjaxDataProp": "result",
                "aoColumns": [
                    { "mData": "lesson.start" },
                    { "mData": "lesson.end" },
                    { "mData": "lesson.instructor" },
                    { "mData": "lesson.student" },
                    { "mData": "lesson.location" },
                    { "mData": "lesson.note" }
                ],
                "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
                    $.ajax({
                        type: "GET",
                        url: aData.lesson.student
                    }).done(function(data) {
                                $('td:eq(3)', nRow).html('<a href="/admin' + aData.lesson.student.replace('student', 'students') + '">' + data.student.name + '</a>');
                    });
                    return nRow;
                }
            });
        } );
    </script>
  </div>
  <!-- /widget-content -->
</div>
<!-- /widget -->


